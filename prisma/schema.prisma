generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["linux-musl-openssl-3.0.x"] // âœ… For Alpine Linux
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int               @id @default(autoincrement())
  telegramId   BigInt            @unique
  username     String?
  firstName    String?
  lastName     String?
  languageCode String?
  createdAt    DateTime          @default(now())
  role         String            @default("User")
  concerts     Concert[]
  responses    ConcertResponse[]
}

model Concert {
  id          Int               @id @default(autoincrement())
  userId      Int
  artistName  String
  venue       String
  concertDate DateTime
  concertTime DateTime?
  url         String?
  notes       String?
  notified    Boolean           @default(false)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  responses   ConcertResponse[]

  @@index([concertDate])
  @@index([userId])
}

model ConcertResponse {
  id           Int      @id @default(autoincrement())
  concertId    Int
  userId       Int
  responseType String
  createdAt    DateTime @default(now())
  concert      Concert  @relation(fields: [concertId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([concertId, userId])
}

enum ResponseType {
  going
  interested
  not_going
}
